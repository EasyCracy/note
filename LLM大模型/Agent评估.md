# Agent Quality Evaluation 

## 1. 核心概念：为什么需要评估 Agent？

Agent（智能体）具有自主决策、工具调用和多步推理的能力，传统的文本生成评估（如针对 LLM 的评估）已不足以衡量其在复杂任务中的表现。

### 1.1 评估维度的必要性

| 维度       | 关注点             | 风险示例                  |
| :------- | :-------------- | :-------------------- |
| **技术层面** | 决策正确性、工具调用准确性   | 信贷 Agent 错误批准高风险贷款    |
| **业务层面** | 任务完成率、ROI、用户满意度 | 客服 Agent 无法解决问题导致客户流失 |
| **伦理合规** | 偏见、隐私、安全性       | 招聘 Agent 因性别偏见筛选简历    |
| **迭代层面** | 性能瓶颈分析、持续优化     | 无法量化改进方向，盲目优化         |

### 1.2 评估的一般步骤

1. **定义目标**：结合应用场景（如客服、代码助手）确定关键指标。
2. **数据准备**：使用真实业务数据或通过 Self-instruct 生成测试集（尤其关注多步推理场景）。
3. **执行与分析**：
   - **自动化评估**：使用 LLM as Judge（高效率）。
   - **人工评估**：用于定性分析（高准确度）。

4. **迭代优化**：根据归因分析结果优化 Agent 及其 Prompt/Tools。

---

## 2. 评估指标体系 (Metrics)

构建评估体系时，应组合使用以下三类指标：
### 2.1 业务类指标 (Business Metrics)

直接反映 Agent 对业务价值的贡献。

- **任务完成率 (TCR)**：成功完成任务数 / 总任务数。

  - *场景*：电商退换货由 Agent 自主闭环的比例。

- **决策准确率 (Decision Accuracy)**：关键推理步骤的正确性。

  - *场景*：医疗 Agent 在诊断过程中排除错误病因的正确率。

- **工具调用正确率 (Tool Call Accuracy)**：调用工具的必要性与参数正确性。

  - *场景*：HR Agent 仅在必要时调用“学历验证”接口。

### 2.2 效率类指标 (Efficiency Metrics)

衡量资源消耗与响应速度。

- **平均任务耗时**：完成单一任务的全流程时间。
- **平均交互轮数**：解决问题所需的对话次数（越少通常越高效）。

### 2.3 安全与伦理指标 (Safety & Ethics)

- **偏见发生率**：在不同人群/地区样本上的表现差异。
- **合规性检查**：是否泄露 PII（个人敏感信息）或违规操作。

---

## 3. 主流评估框架 (Frameworks)

| 框架名称 | 特点 | 适用场景 | 关键指标示例 |
| :--- | :--- | :--- | :--- |
| **AgentBoard** | 细粒度分析、过程追踪 | 需要深入分析推理过程、探索能力的场景 | **Progress Rate** (进度率)：多步任务中完成子目标的比例<br>**Grounding Accuracy** (落地准确率)：动作的合法性 |
| **AgentBench** | 多环境、多任务覆盖 | 综合能力评测、跨场景泛化能力 | **Success Rate** (成功率)：在 OS、DB、网页等不同环境下的表现 |
| **τ-bench** | 模拟真实用户交互 | 客服、零售等高交互性场景 | **Pass Rate**：任务流转的数据一致性<br>**Tool Accuracy**：工具参数正确性 |

---

## 4. 实践建议：如何构建评估系统

### 4.1 数据准备策略

- **冷启动**：若无真实数据，人工编写少量 Seed Data，利用 LLM 扩充测试集。
- **热迭代**：从线上日志中脱敏抽取真实用户 Query。

### 4.2 评估方法组合

> **推荐模式：自动化定量 + 人工定性**

1. **粗粒度检测**：检查最终状态（如数据库字段是否更新正确）。
2. **细粒度检测**：使用 **LLM as Judge** 评估中间推理步骤。
3. **人工复核**：定期抽样，校准 LLM as Judge 的判断标准。

### 4.3 归因分析与可观测性

- **归因分析**：任务失败时，分析是 **规划错误**（Planning Error）还是 **工具执行错误**（Execution Error）。
- **工具链集成**：
  - 使用 **Langfuse** 等工具追踪 Trace，通过可视化界面监控 Token 消耗与 Latency。
  - 对接 **TaskManager**，实时记录工作流状态与异常。

  

### 4.4 案例参考

- **零售客服**：参考 τ-bench，重点关注是否正确修改了订单状态。
- **调研助手**：参考 AgentBoard，关注生成的报告内容的完整性与准确性。
- **试题生成**：关注工具调用的参数格式与生成内容的逻辑自洽。

---

## 5. 总结

建立完善的 Agent 质量评估体系是 Agent 从 Demo 走向 Production 的必经之路。

**核心口诀**：
- 业务指标看结果（TCR）
- 过程指标看能力（工具调用、推理路径）
- 安全指标守底线（偏见、合规）
- 工具辅助提效率（LLM as Judge, Langfuse）

## 参考链接

https://aws.amazon.com/cn/blogs/china/agent-quality-evaluation/